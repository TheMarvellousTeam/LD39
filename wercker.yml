
build-desktop:

    box: openjdk:8-alpine

    steps:

        - script:
            name: build desktop
            code: ./gradlew desktop:dist

build-html:

    box: openjdk:8-alpine

    steps:

        - script:
            name: build html
            code: ./gradlew html:dist
            
build-android:
    
    #this box ship the android sdk 26.0.1
    box: thyrlian/android-sdk:1.6

    steps:
            
        - script:
            name: build android
            code: ./gradlew android:assembleRelease





deploy:
    
    box: indiehosters/git
    
    steps:
        
        - script:
            name: get current gh-pages
            code: |
                git clone --branch gh-pages --depth 1 https://$WERCKER_GIT_OWNER:$GH_TOKEN@$WERCKER_GIT_DOMAIN/$WERCKER_GIT_OWNER/$WERCKER_GIT_REPOSITORY.git gh-pages
                
        - script:
            name: copy build
            code: |
                mkdir -p ./gh-pages/version/$WERCKER_GIT_BRANCH
                
                # copy html
                if [ -d "html/build/dist" ]; then
                    rm -r ./gh-pages/version/$WERCKER_GIT_BRANCH/html || echo 1
                    mv ./html/build/dist ./gh-pages/version/$WERCKER_GIT_BRANCH/html
                else
                    echo "no html build found"
                fi
                
                # copy android
                if [ -d "android/build/outputs/apk" ]; then
                    rm -r ./gh-pages/version/$WERCKER_GIT_BRANCH/android || echo 1
                    mv ./android/build/outputs/apk ./gh-pages/version/$WERCKER_GIT_BRANCH/android
                else
                    echo "no android build found"
                fi
        
                # copy desktop 
                if [ -d "desktop/build/libs" ]; then
                    rm -r ./gh-pages/version/$WERCKER_GIT_BRANCH/desktop || echo 1
                    mv ./desktop/build/libs ./gh-pages/version/$WERCKER_GIT_BRANCH/desktop
                else
                    echo "no desktop build found"
                fi
                 
        - script:
            name: push
            cwd: gh-pages
            code: |
                # config git
                git config --global user.email "bot@marvelous.team"
                git config --global user.name "ana"
            
                # create new orphan branch
                git checkout --orphan tmp
                
                # remove gh-pages branch
                git branch -D gh-pages
                
                # commit to the new branch
                git add .
                git commit -m $WERCKER_GIT_COMMIT
                
                # rename the new branch
                git branch -m gh-pages
                
                # push
                git push --force --set-upstream origin gh-pages
